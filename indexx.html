<!DOCTYPE html>
<html lang="en">
    <head>
        <title>three.js webgl - PLY</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                font-family: Monospace;
                background-color: #000000;
                margin: 0px;
                overflow: hidden;
            }
            #info {
                color: #fff;
                position: absolute;
                top: 10px;
                width: 100%;
                text-align: center;
                z-index: 100;
                display:block;
            }
            a { color: skyblue }
            .button { background:#999; color:#eee; padding:0.2em 0.5em; cursor:pointer }
            .highlight { background:orange; color:#fff; }
            span {
                display: inline-block;
                width: 60px;
                float: left;
                text-align: center;
            }
            #pickpoint{
                position:absolute;
                font-family: 'Nunito', sans-serif;
                font-weight: 700;
                bottom:-50px;
                left:0;   
                cursor:pointer 
            }
            #txtarea{
               position:absolute;
                font-family: 'Nunito', sans-serif;
                font-weight: 700; 
                left:0; 
                bottom: -160px;  

            }
        </style>
    </head>
    <body>
        <div id="info">
            3d model of criminal ####
        <br>  <br> <br>
            <button id="pickpoint" onclick="calcDistance()">Pick points</button>
            <textarea cols="1" id="txtarea">Distance:xxx</textarea>
        </div>


        <script src="lib/three.js"></script>

        <script src="lib/PLYLoader.js"></script>

        <script src="lib/Detector.js"></script>
        <script src="lib/stats.min.js"></script>

        <script>
            if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
            var container, stats;
            var camera, cameraTarget, scene, renderer;
          //  var location='model/S002_001.ply';
          var filepath;
          var clickedd=true;
            init();
            animate();
            function init() {
                container = document.createElement( 'div' );
                document.body.appendChild( container );
                camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 1, 15 );
                camera.position.set( 3, 0.15, 3 );
                cameraTarget = new THREE.Vector3( 0, -0.1, 0 );
                scene = new THREE.Scene();
                scene.background = new THREE.Color( 0x72645b );
                scene.fog = new THREE.Fog( 0x72645b, 2, 15 );
                // Ground
                var plane = new THREE.Mesh(
                    new THREE.PlaneBufferGeometry( 40, 40 ),
                    new THREE.MeshPhongMaterial( { color: 0x999999, specular: 0x101010 } )
                );
                plane.rotation.x = -Math.PI/2;
                plane.position.y = -0.5;
                scene.add( plane );
                plane.receiveShadow = true;
                // PLY file
                var loader = new THREE.PLYLoader();

                if(clickedd==1){
                    getFile('model/S002_001.ply');
                 }
                 console.log(clickedd);
                loader.load( filepath, function ( geometry ) {
                    geometry.computeVertexNormals();
                    var material = new THREE.MeshStandardMaterial( { color: 0x0055ff, flatShading: true } );
                    var mesh = new THREE.Mesh( geometry, material );
                   // mesh.position.x =  -0.2;
                    mesh.position.y =  0.45;
                    mesh.position.z =  0;
                    mesh.rotation.x = - Math.PI / 2;
                    mesh.scale.multiplyScalar( 0.6 );
                    mesh.castShadow = true;
                   // mesh.receiveShadow = true;
                    scene.add( mesh );
                } );
                // Lights
                scene.add( new THREE.HemisphereLight( 0x443333, 0x111122 ) );
                addShadowedLight( 1, 1, 1, 0xffffff, 1.35 );
                addShadowedLight( 0.5, 1, -1, 0xffaa00, 1 );
                // renderer
                renderer = new THREE.WebGLRenderer( { antialias: true } );
                renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.gammaInput = true;
                renderer.gammaOutput = true;
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.renderReverseSided = false;
                container.appendChild( renderer.domElement );
                // stats
                stats = new Stats();
                container.appendChild( stats.dom );
                // resize
                window.addEventListener( 'resize', onWindowResize, false );
                document.addEventListener('mousedown', onDocumentMouseDown, false);

            }


            function calcDistance(){
                clickedd=false;
            }
               //method for getting x,y,z coordinates of mouse click 
                function onDocumentMouseDown( event ) {
                 filepath='model/S001_001.ply';
                 //location.reload(true);
                    event.preventDefault();
                    var vector = new THREE.Vector3();// 3D coordinate object 
                     vector.set(
                                ( event.clientX / window.innerWidth ) * 2 - 1,
                                - ( event.clientY / window.innerHeight ) * 2 + 1,
                                 0.5 );
                    vector.unproject( camera );
                    var raycaster = new THREE.Raycaster(camera.position, vector.sub(camera.position).normalize());
                    var intersects = raycaster.intersectObjects(scene.children);
                    if (intersects.length > 0) {
                     var selected = intersects[0];// Take the first object
                     if (!clickedd){ 
                     console.log("x coordinate :"+selected.point.x);
                     console.log("y coordinate :"+selected.point.y);
                    console.log("z coordinate :"+selected.point.z);
                }
                     }
                }

            function addShadowedLight( x, y, z, color, intensity ) {
                var directionalLight = new THREE.DirectionalLight( color, intensity );
                directionalLight.position.set( x, y, z );
                scene.add( directionalLight );
                directionalLight.castShadow = true;
                var d = 1;
                directionalLight.shadow.camera.left = -d;
                directionalLight.shadow.camera.right = d;
                directionalLight.shadow.camera.top = d;
                directionalLight.shadow.camera.bottom = -d;
                directionalLight.shadow.camera.near = 1;
                directionalLight.shadow.camera.far = 4;
                directionalLight.shadow.mapSize.width = 1024;
                directionalLight.shadow.mapSize.height = 1024;
                directionalLight.shadow.bias = -0.005;
            }
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );
            }
            function animate() {
                //add some code to stop animating when u r clicking . i can try to use a boolean value to check before do animating 
                requestAnimationFrame( animate );
                render();
                stats.update();
            }
            function render() {
              // if(!clickedd){
                //    init();
                  //  animate();
                //}
                var timer = Date.now() * 0.0005;
                camera.position.x = Math.sin( timer ) * 2.5;
                camera.position.z = Math.cos( timer ) * 2.5;
                camera.lookAt( cameraTarget );
                renderer.render( scene, camera );
            }
            function getFile(x){
                 filepath=x;
            }


 


        </script>
    </body>
</html>